# Smart Speed Control System - Architecture & Design Document

## System Architecture Diagram

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                         3D SIMULATION ENVIRONMENT                           β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚  β”‚ Panda3D Graphics Engine                                               β”‚  β”‚
β”‚  β”‚ β€Ά 3D Ground & Road Zones (Colored overlays)                          β”‚  β”‚
β”‚  β”‚ β€Ά Vehicle 3D Model (Cyan cube, extensible)                           β”‚  β”‚
β”‚  β”‚ β€Ά Third-person camera system                                         β”‚  β”‚
β”‚  β”‚ β€Ά Real-time lighting & shadows                                       β”‚  β”‚
β”‚  β”‚ β€Ά 60 FPS rendering loop                                              β”‚  β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚  β”‚ Input System                  β”‚ HUD System                             β”‚  β”‚
β”‚  β”‚ β€Ά Arrow key capture           β”‚ β€Ά Speed display                       β”‚  β”‚
β”‚  β”‚ β€Ά Velocity calculation        β”‚ β€Ά Zone name                           β”‚  β”‚
β”‚  β”‚ β€Ά Steering on-frame           β”‚ β€Ά State indicator (color-coded)       β”‚  β”‚
β”‚  β”‚ β€Ά Reset function              β”‚ β€Ά GPS coordinates                     β”‚  β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                    β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                    PHYSICS SIMULATION ENGINE                                 β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚ VehiclePhysics                                                       β”‚   β”‚
β”‚  β”‚ β€Ά Position tracking (x, y, z)                                        β”‚   β”‚
β”‚  β”‚ β€Ά Velocity simulation (0-120 km/h)                                   β”‚   β”‚
β”‚  β”‚ β€Ά Acceleration logic (30 km/h/s)                                     β”‚   β”‚
β”‚  β”‚ β€Ά Deceleration & friction (15-40 km/h/s)                             β”‚   β”‚
β”‚  β”‚ β€Ά Steering & heading (90Β°/s rotation)                                β”‚   β”‚
β”‚  β”‚ β€Ά Max speed limiting                                                 β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                    β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                     ZONE MANAGEMENT SYSTEM                                   β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚ ZoneManager                                                          β”‚   β”‚
β”‚  β”‚ β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚   β”‚
β”‚  β”‚ β”‚ School Zone: X(-100,0)   β†’ 50 km/h  (Yellow)                β”‚  β”‚   β”‚
β”‚  β”‚ β”‚ City Road:   X(0,100)    β†’ 60 km/h  (Gray)                  β”‚  β”‚   β”‚
β”‚  β”‚ β”‚ Highway:     X(100,300)  β†’ 80 km/h  (Dark Gray)             β”‚  β”‚   β”‚
β”‚  β”‚ β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚   β”‚
β”‚  β”‚                                                                      β”‚   β”‚
β”‚  β”‚ β€Ά Real-time zone detection from X,Y position                         β”‚   β”‚
β”‚  β”‚ β€Ά Speed limit lookup                                                 β”‚   β”‚
β”‚  β”‚ β€Ά Zone boundary tracking                                             β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                    β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                    SPEED CONTROL ENGINE                                      β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚ ControlEngine - State Machine                                        β”‚   β”‚
β”‚  β”‚                                                                      β”‚   β”‚
β”‚  β”‚ β”β”€β”€β”€β”€β”€β”         β”β”€β”€β”€β”€β”€β”         β”β”€β”€β”€β”€β”€β”€β”€β”€β”                         β”‚   β”‚
β”‚  β”‚ β”‚     β”‚β”€β”€β”€β”€β”€β–Ί   β”‚     β”‚β”€β”€β”€β”€β–Ί    β”‚        β”‚                         β”‚   β”‚
β”‚  β”‚ β”‚   N β”‚ speed β—† β”‚ W A β”‚ β—†speed  β”‚ REG    β”‚                         β”‚   β”‚
β”‚  β”‚ β”‚ ORM β”‚+5 km/h  β”‚RNNG β”‚ >limit  β”‚        β”‚                         β”‚   β”‚
β”‚  β”‚ β”‚     β”‚β—„β”€β”€β”€β”€β”€   β”‚     β”‚β—„β”€β”€β”€β”€β”€   β”‚        β”‚                         β”‚   β”‚
β”‚  β”‚ β””β”€β”€β”€β”€β”€β”         β””β”€β”€β”€β”€β”€β”         β””β”€β”€β”€β”€β”€β”€β”€β”€β”                         β”‚   β”‚
β”‚  β”‚   β“ Normal        β  Warning      π”΄ Regulating                      β”‚   β”‚
β”‚  β”‚   β€Ά Regulation   β€Ά 50% accel    β€Ά Prop. reduced accel              β”‚   β”‚
β”‚  β”‚     factor: 100% β€Ά Audio on     β€Ά Max overspeed clamped            β”‚   β”‚
β”‚  β”‚   β€Ά No alerts    β€Ά Yellow LED   β€Ά Red LED on                       β”‚   β”‚
β”‚  β”‚   β€Ά Green LED    β€Ά Blinking 2Hz β€Ά Audio siren                      β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚                                                                              β”‚
β”‚  State Transitions:                                                          β”‚
β”‚  β€Ά NORMAL β†’ WARNING:     when speed > limit AND speed β‰¤ limit + 5            β”‚
β”‚  β€Ά WARNING β†’ REGULATING: when speed > limit + 5                              β”‚
β”‚  β€Ά Any β†’ NORMAL:         when speed β‰¤ limit                                  β”‚
β”‚                                                                              β”‚
β”‚  Output:                                                                     β”‚
β”‚  β€Ά Regulation factor (0.0 - 1.0) β†’ Applied to user acceleration             β”‚
β”‚  β€Ά State notification β†’ Audio & callback system                              β”‚
β”‚  β€Ά HUD color indicator β†’ Visual feedback                                     β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                    β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                  MQTT IoT COMMUNICATION LAYER                                β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚ SmartSpeedMQTTClient                                                 β”‚   β”‚
β”‚  β”‚                                                                      β”‚   β”‚
β”‚  β”‚ β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”                                             β”‚   β”‚
β”‚  β”‚ β”‚ Publish (500ms):     β”‚                                             β”‚   β”‚
β”‚  β”‚ β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤                                             β”‚   β”‚
β”‚  β”‚ β”‚ vehicle/smart_speed/β”‚                                              β”‚   β”‚
β”‚  β”‚ β”‚  location            β”‚ β†’ {"lat": X/1000, "lon": Y/1000}           β”‚   β”‚
β”‚  β”‚ β”‚  speed               β”‚ β†’ {"speed": float, "limit": float}         β”‚   β”‚
β”‚  β”‚ β”‚  state               β”‚ β†’ {"state": "NORMAL|WARNING|REGULATING"}   β”‚   β”‚
β”‚  β”‚ β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”                                             β”‚   β”‚
β”‚  β”‚                                                                      β”‚   β”‚
β”‚  β”‚ Connection:                                                          β”‚   β”‚
β”‚  β”‚ β€Ά Host: 127.0.0.1 (configurable)                                     β”‚   β”‚
β”‚  β”‚ β€Ά Port: 1883                                                         β”‚   β”‚
β”‚  β”‚ β€Ά Keep-alive: 60s                                                    β”‚   β”‚
β”‚  β”‚ β€Ά Auto-reconnect: Enabled                                            β”‚   β”‚
β”‚  β”‚ β€Ά QoS: 1                                                             β”‚   β”‚
β”‚  β”‚ β€Ά Clean session: True                                                β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                    β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                  ESP32 EMBEDDED SYSTEM LAYER                                 β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚ ESP32 Microcontroller (Wokwi Simulation)                             β”‚   β”‚
β”‚  β”‚                                                                      β”‚   β”‚
β”‚  β”‚ β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”               β”‚   β”‚
β”‚  β”‚ β”‚   WiFi      β”‚   β”‚    MQTT     β”‚   β”‚   Message    β”‚               β”‚   β”‚
β”‚  β”‚ β”‚ Connection  β”‚β”€β”€β–Ίβ”‚ Subscriptionβ”‚β”€β”€β–Ίβ”‚   Parser     β”‚               β”‚   β”‚
β”‚  β”‚ β”‚             β”‚   β”‚             β”‚   β”‚  (JSON)      β”‚               β”‚   β”‚
β”‚  β”‚ β”‚ Wokwi-GUEST β”‚   β”‚ broker.     β”‚   β”‚              β”‚               β”‚   β”‚
β”‚  β”‚ β”‚ (or local)  β”‚   β”‚ hivemq.com  β”‚   β”‚ State: "STR" β”‚               β”‚   β”‚
β”‚  β”‚ β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”               β”‚   β”‚
β”‚  β”‚        β†“                  β†“                   β†“                      β”‚   β”‚
β”‚  β”‚ β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚   β”‚
β”‚  β”‚ β”‚              LED CONTROL LOGIC                               β”‚   β”‚   β”‚
β”‚  β”‚ β”‚                                                              β”‚   β”‚   β”‚
β”‚  β”‚ β”‚  if state == "NORMAL"                                        β”‚   β”‚   β”‚
β”‚  β”‚ β”‚    β”β”€ GPIO 17 (Green LED) β†’ ON (steady)                      β”‚   β”‚   β”‚
β”‚  β”‚ β”‚    β”β”€ GPIO 19 (Yellow LED) β†’ OFF                             β”‚   β”‚   β”‚
β”‚  β”‚ β”‚    β””β”€ GPIO 18 (Red LED) β†’ OFF                                β”‚   β”‚   β”‚
β”‚  β”‚ β”‚                                                              β”‚   β”‚   β”‚
β”‚  β”‚ β”‚  else if state == "WARNING"                                  β”‚   β”‚   β”‚
β”‚  β”‚ β”‚    β”β”€ GPIO 17 (Green LED) β†’ OFF                              β”‚   β”‚   β”‚
β”‚  β”‚ β”‚    β”β”€ GPIO 19 (Yellow LED) β†’ BLINK (2Hz, non-blocking)      β”‚   β”‚   β”‚
β”‚  β”‚ β”‚    β””β”€ GPIO 18 (Red LED) β†’ OFF                                β”‚   β”‚   β”‚
β”‚  β”‚ β”‚                                                              β”‚   β”‚   β”‚
β”‚  β”‚ β”‚  else if state == "REGULATING"                               β”‚   β”‚   β”‚
β”‚  β”‚ β”‚    β”β”€ GPIO 17 (Green LED) β†’ OFF                              β”‚   β”‚   β”‚
β”‚  β”‚ β”‚    β”β”€ GPIO 19 (Yellow LED) β†’ OFF                             β”‚   β”‚   β”‚
β”‚  β”‚ β”‚    β””β”€ GPIO 18 (Red LED) β†’ ON (steady)                        β”‚   β”‚   β”‚
β”‚  β”‚ β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚   β”‚
β”‚  β”‚                                                                      β”‚   β”‚
β”‚  β”‚ Features:                                                            β”‚   β”‚
β”‚  β”‚ β€Ά Non-blocking millis() timing                                       β”‚   β”‚
β”‚  β”‚ β€Ά Auto WiFi reconnection (5s interval)                               β”‚   β”‚
β”‚  β”‚ β€Ά Auto MQTT reconnection (5s interval)                               β”‚   β”‚
β”‚  β”‚ β€Ά Serial debug output                                                β”‚   β”‚
β”‚  β”‚ β€Ά JSON message parsing                                               β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## Data Flow Sequence Diagram

```
USER INTERACTION β†’ PHYSICS β†’ ZONE DETECTION β†’ SPEED CHECK β†’ STATE DECISION β†’ ACTION
β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€

Game Loop (60 Hz):
    β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 1. Read Input (key_up, key_down, key_left, key_right)                     β”‚
β”‚    Calculate: acceleration, steering, braking                             β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                                              β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 2. Vehicle Physics Update                                                β”‚
β”‚    β€Ά Apply acceleration: velocity += accel * dt * factor                 β”‚
β”‚    β€Ά Apply friction: velocity -= friction * dt                           β”‚
β”‚    β€Ά Update position: x += velocity * cos(heading) * dt                  β”‚
β”‚    β€Ά Update position: y += velocity * sin(heading) * dt                  β”‚
β”‚    β€Ά Update heading: rotation += steering * angular_speed * dt           β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                                           β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 3. Zone Detection                                                        β”‚
β”‚    zone = ZoneManager.update_position(x, y)                             β”‚
β”‚    speed_limit = zone.speed_limit                                       β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                                           β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 4. Speed Control Logic                                                   β”‚
β”‚    ControlEngine.update(current_speed, speed_limit)                     β”‚
β”‚                                                                          β”‚
β”‚    Calculate state:                                                      β”‚
β”‚    if speed β‰¤ limit:                    state = NORMAL                   β”‚
β”‚    elif limit < speed β‰¤ limit + 5:      state = WARNING                  β”‚
β”‚    else:                                 state = REGULATING               β”‚
β”‚                                                                          β”‚
β”‚    Calculate regulation_factor:                                          β”‚
β”‚    if state == NORMAL:        factor = 1.0                               β”‚
β”‚    elif state == WARNING:      factor = 0.5                              β”‚
β”‚    else:                       factor = (1.0 - overspeed/10.0)           β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                                           β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 5. State Actions                                                         β”‚
β”‚    β€Ά Play audio (WARNING beep / REGULATING alarm)                        β”‚
β”‚    β€Ά Trigger callbacks (HUD & MQTT)                                      β”‚
β”‚    β€Ά Apply regulation_factor to next frame acceleration                  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                                           β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 6. HUD Update (every 50ms)                                               β”‚
β”‚    Display:                                                              β”‚
β”‚    β€Ά Speed (km/h)                                                        β”‚
β”‚    β€Ά Speed Limit (km/h)                                                  β”‚
β”‚    β€Ά Zone Name                                                           β”‚
β”‚    β€Ά System State (color-coded)                                          β”‚
β”‚    β€Ά GPS coordinates                                                     β”‚
β”‚    β€Ά MQTT connection status                                              β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                                           β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 7. 3D Rendering                                                          β”‚
β”‚    Update vehicle position in 3D scene                                   β”‚
β”‚    Update camera position (follow vehicle)                               β”‚
β”‚    Render frame to screen                                                β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                                           β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 8. MQTT Telemetry (every 500ms)                                          β”‚
β”‚    Publish('/vehicle/smart_speed/location', lat, lon)                   β”‚
β”‚    Publish('/vehicle/smart_speed/speed', speed, limit)                  β”‚
β”‚    Publish('/vehicle/smart_speed/state', state, color)                  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                                           β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 9. ESP32 Receives & Processes                                            β”‚
β”‚    β€Ά ESP32 receives MQTT message on subscribed topic                     β”‚
β”‚    β€Ά Parses JSON payload                                                 β”‚
β”‚    β€Ά Extracts state value                                                β”‚
β”‚    β€Ά Controls LEDs accordingly                                           β”‚
β”‚    β€Ά Non-blocking blink with millis()                                    β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”


                         [LOOP CONTINUES AT 60 Hz]
```

## Module Dependencies

```
main.py
β”β”€β”€ config.py
β”β”€β”€ core.physics.VehiclePhysics
β”β”€β”€ core.vehicle.Vehicle
β”‚   β””β”€β”€ core.physics
β”β”€β”€ core.zone_manager.ZoneManager
β”β”€β”€ core.control_engine.ControlEngine
β”β”€β”€ core.mqtt_client.SmartSpeedMQTTClient
β”β”€β”€ ui.hud.HUD
β””β”€β”€ ui.audio_manager.AudioManager

config.py
β””β”€β”€ (No dependencies)

core/physics.py
β””β”€β”€ config.py

core/vehicle.py
β””β”€β”€ core.physics.py

core/zone_manager.py
β””β”€β”€ config.py

core/control_engine.py
β””β”€β”€ config.py

core/mqtt_client.py
β”β”€β”€ config.py
β””β”€β”€ paho.mqtt.client

ui/hud.py
β””β”€β”€ config.py

ui/audio_manager.py
β””β”€β”€ config.py

firmware/esp32_smart_speed.ino
β”β”€β”€ WiFi.h
β”β”€β”€ PubSubClient.h
β””β”€β”€ ArduinoJson.h
```

## Performance Metrics

| Aspect | Target | Actual |
|--------|--------|--------|
| Frame Rate | 60 FPS | ~60 FPS |
| Physics Update | 60 Hz | 60 Hz (dt-based) |
| MQTT Publish | 2 Hz (500ms) | 2 Hz (consistent) |
| HUD Update | 20 Hz (50ms) | 20 Hz (consistent) |
| Input Latency | < 50ms | < 33ms (frame-based) |
| Memory Usage | < 200MB | ~180MB (Panda3D) |
| ESP32 Loop | 10-20 Hz | 15-18 Hz (non-blocking) |

## Scalability Considerations

### Adding New Zones
1. Add zone definition to `config.py` ZONES dictionary
2. ZoneManager automatically creates zone overlays
3. Vehicle automatically detects new zone boundaries

### Adding More ESP32 Devices
1. Change `MQTT_CLIENT_ID` in firmware
2. Subscribe to same or different topics
3. Implement different LED patterns for different devices

### Increasing MQTT Publish Rate
1. Modify `MQTT_PUBLISH_INTERVAL` in config.py
2. Note: Broker may rate-limit at 1000+ Hz
3. ESP32 can handle up to ~10 Hz on local network

### Adding WebSocket Dashboard
1. Implement WebSocket server in separate thread
2. Subscribe MQTT messages via message callback
3. Forward to connected WebSocket clients
4. Real-time web visualization

## Extensibility Points

### Custom Physics Models
Replace `core/physics.py` with:
- Advanced suspension systems
- Traction control algorithms
- Anti-lock braking systems (ABS)
- Cornering physics

### Custom Rendering
Extend `main.py`:
- Load 3D models for vehicle
- Terrain mesh instead of flat ground
- Real weather effects
- Traffic simulation

### Custom Control Logic
Extend `core/control_engine.py`:
- Predictive speed control
- Machine learning-based prediction
- Driver behavior analysis
- Fuel efficiency optimization

### IoT Integrations
Extend `core/mqtt_client.py`:
- Cloud telemetry (AWS IoT, Azure)
- D database logging
- Web API endpoints
- Real-time analytics

---

**Architecture Version**: 1.0
**Last Updated**: February 2026
